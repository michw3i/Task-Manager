<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Task Manager | To-do Calendar</title>
<style>
  body { font-family: Arial, sans-serif; text-align: center; }
  table { border-collapse: collapse; margin: auto; width: 350px; }
  th, td { border: 1px solid #ccc; width: 45px; height: 60px; vertical-align: top; padding: 2px; position: relative; }
  th { background: #f4f4f4; }
  td.today { background: #ffeb3b; }
  td.has-event { background: #e0f7fa; }
  div.event { font-size: 0.7em; background: #b2dfdb; margin: 1px 0; padding: 1px 2px; border-radius: 3px; cursor: pointer; overflow-wrap: break-word; }
  div.delete { font-weight: bold; color: red; margin-left: 3px; cursor: pointer; }
  #navButtons { margin-bottom: 10px; }
  button { margin: 0 10px; padding: 5px 10px; }
</style>
</head>
<body>

<h2 id="monthYear"></h2>
<div id="navButtons">
  <button id="prevMonth">&lt; Previous</button>
  <button id="nextMonth">Next &gt;</button>
</div>

<table id="calendar">
  <thead>
    <tr>
      <th>Sun</th><th>Mon</th><th>Tue</th><th>Wed</th>
      <th>Thu</th><th>Fri</th><th>Sat</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<h3>Add Event</h3>
<form id="eventForm">
  <label>Date: <input type="date" id="eventDate" required></label>
  <label>Event: <input type="text" id="eventText" required></label>
  <button type="submit">Add Event</button>
</form>

<script>
// Load events from localStorage
let events = JSON.parse(localStorage.getItem("calendarEvents") || "{}");

// Track current displayed month and year
let currentDate = new Date();

function saveEvents() {
  localStorage.setItem("calendarEvents", JSON.stringify(events));
}

function generateCalendar(date) {
  const tbody = document.querySelector("#calendar tbody");
  tbody.innerHTML = "";

  const year = date.getFullYear();
  const month = date.getMonth();
  const firstDay = new Date(year, month).getDay();
  const daysInMonth = new Date(year, month + 1, 0).getDate();
  const today = new Date();

  document.getElementById("monthYear").textContent =
    date.toLocaleString("default", { month: "long", year: "numeric" });

  let row = document.createElement("tr");
  for (let i = 0; i < firstDay; i++) row.appendChild(document.createElement("td"));

  for (let day = 1; day <= daysInMonth; day++) {
    const cell = document.createElement("td");
    const dateStr = `${year}-${String(month+1).padStart(2,'0')}-${String(day).padStart(2,'0')}`;

    const dayNumber = document.createElement("div");
    dayNumber.textContent = day;
    dayNumber.style.fontWeight = "bold";
    cell.appendChild(dayNumber);

    if (day === today.getDate() && month === today.getMonth() && year === today.getFullYear()) {
      cell.classList.add("today");
    }

    if (events[dateStr]) {
      cell.classList.add("has-event");
      events[dateStr].forEach((ev, idx) => {
        const evDiv = document.createElement("div");
        evDiv.textContent = ev;
        evDiv.classList.add("event");

        // Delete button
        const delBtn = document.createElement("span");
        delBtn.textContent = "Ã—";
        delBtn.classList.add("delete");
        delBtn.onclick = (e) => {
          e.stopPropagation();
          events[dateStr].splice(idx, 1);
          if (events[dateStr].length === 0) delete events[dateStr];
          saveEvents();
          generateCalendar(currentDate);
        };
        evDiv.appendChild(delBtn);

        cell.appendChild(evDiv);
      });
    }

    row.appendChild(cell);
    if ((firstDay + day) % 7 === 0 || day === daysInMonth) {
      tbody.appendChild(row);
      row = document.createElement("tr");
    }
  }
}

// Navigation buttons
document.getElementById("prevMonth").addEventListener("click", () => {
  currentDate.setMonth(currentDate.getMonth() - 1);
  generateCalendar(currentDate);
});
document.getElementById("nextMonth").addEventListener("click", () => {
  currentDate.setMonth(currentDate.getMonth() + 1);
  generateCalendar(currentDate);
});

// Add event
document.getElementById("eventForm").addEventListener("submit", (e) => {
  e.preventDefault();
  const date = document.getElementById("eventDate").value;
  const text = document.getElementById("eventText").value;

  if (!events[date]) events[date] = [];
  events[date].push(text);
  saveEvents();

  generateCalendar(currentDate);
  document.getElementById("eventForm").reset();
});

// Initial calendar load
generateCalendar(currentDate);
</script>

</body>
</html>

